"use strict";var mongoose=require("mongoose");require("./config/db");var express=require("express"),Handlebars=require("handlebars"),exphbs=require("express-handlebars"),_require=require("@handlebars/allow-prototype-access"),allowInsecurePrototypeAccess=_require.allowInsecurePrototypeAccess,path=require("path"),router=require("./routes"),cookieParser=require("cookie-parser"),session=require("express-session"),MongoStore=require("connect-mongo")(session),bodyParser=require("body-parser"),expressValidator=require("express-validator"),flash=require("connect-flash"),createError=require("http-errors"),passport=require("./config/passport");require("dotenv").config({path:"variables.env"});var app=express();app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.use(expressValidator()),app.engine("handlebars",exphbs({defaultLayout:"layout",helpers:require("./helpers/handlebars"),handlebars:allowInsecurePrototypeAccess(Handlebars)})),app.use(cookieParser()),app.use(session({secret:process.env.SECRETO,key:process.env.KEY,resave:!1,saveUninitialized:!1,store:new MongoStore({mongooseConnection:mongoose.connection})})),app.use(passport.initialize()),app.use(passport.session()),app.use(flash()),app.use(function(e,r,s){r.locals.mensajes=e.flash(),s()}),app.use(express.static(path.join(__dirname,"public"))),app.use("/",router()),app.use(function(e,r,s){s(createError(404,"No Encontrado"))}),app.use(function(e,r,s){s.locals.mensaje=e.message;var a=e.status||500;s.locals.status=a,s.status(a),s.render("error")}),app.set("view engine","handlebars"),app.listen(process.env.PUERTO);